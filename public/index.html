<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>สถานะการส่ง P4P</title>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@5" rel="stylesheet" type="text/css" />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai+Looped:wght@100..900&display=swap"
        rel="stylesheet">
    <script src="https://kit.fontawesome.com/9b1f6eb9b1.js" crossorigin="anonymous"></script>
    <style>
        body {
            font-family: "Noto Sans Thai Looped", sans-serif;
        }

        #pending,
        #sent {
            display: none;
        }
    </style>
</head>

<body>
    <!--header-->
    <div class="navbar bg-base-200 shadow-md sticky flex flex-col align-center top-0 z-10 mb-8 pt-0">
        <div class="flex items-center w-screen">
            <div class="bg-base-300 w-1/2 p-2 pl-12 text-left text-lg font-semibold">ตุลาคม 2568</div>
            <div id="count" class="bg-base-200 w-1/2 p-2 pr-4 text-right text-md skeleton skeleton-text">รวบรวมข้อมูล..
            </div>
        </div>
        <div class="flex justify-center w-screen p-4">
            <label class="input">
                <svg class="h-[1em] opacity-50" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <g stroke-linejoin="round" stroke-linecap="round" stroke-width="2.5" fill="none"
                        stroke="currentColor">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="m21 21-4.3-4.3"></path>
                    </g>
                </svg>
                <input type="search" required placeholder="ค้นหาชื่อแพทย์" />
            </label>
        </div>
    </div>
    <!--content-->
    <div class="grid grid-cols-1 justify-items-center mx-4">
        <div id="load" class="loading loading-bars loading-md"></div>
        <div id="pending" class="collapse collapse-arrow border bg-red-300 mb-4">
            <input type="checkbox" />
            <div class="collapse-title text-lg font-semibold">รายชื่อผู้ที่ยังไม่ได้ส่ง</div>
            <div class="collapse-content">
                <div id="tablebox" class="overflow-x-auto rounded-box border bg-base-100 m-2">
                    <table class="table">
                        <tbody id="tbody_pending"></tbody>
                    </table>
                </div>
            </div>
        </div>
        <div id="sent" class="collapse collapse-arrow border bg-base-300">
            <input type="checkbox" />
            <div class="collapse-title text-lg font-semibold">รายชื่อผู้ที่ส่งแล้ว</div>
            <div class="collapse-content">
                <div id="tablebox" class="overflow-x-auto rounded-box border bg-base-100 m-2">
                    <table class="table">
                        <tbody id="tbody_sent"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <button type="button" id="backtotop"
        class="z-10 fixed bottom-4 right-4 rounded-full shadow-md focus:shadow-lg active:shadow-lg transition duration-150 ease-in-out hidden">
        <svg class="size-10" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640">
            <path fill="#545454"
                d="M320 576C461.4 576 576 461.4 576 320C576 178.6 461.4 64 320 64C178.6 64 64 178.6 64 320C64 461.4 178.6 576 320 576zM441 335C450.4 344.4 450.4 359.6 441 368.9C431.6 378.2 416.4 378.3 407.1 368.9L320.1 281.9L233.1 368.9C223.7 378.3 208.5 378.3 199.2 368.9C189.9 359.5 189.8 344.3 199.2 335L303 231C312.4 221.6 327.6 221.6 336.9 231L441 335z" />
        </svg>
    </button>

    <script src="https://cdn.jsdelivr.net/npm/axios@1.13.2/dist/axios.min.js"></script>
    <script>
        const load = document.getElementById("load")
        const count = document.getElementById("count")
        const pending = document.getElementById("pending")
        const sent = document.getElementById("sent")
        const tbody_pending = document.getElementById("tbody_pending")
        const tbody_sent = document.getElementById("tbody_sent")
        const backtotop = document.getElementById("backtotop");

        const scrolling = () => {
            if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                backtotop.classList.remove("hidden");
            } else {
                backtotop.classList.add("hidden");
            }
        };
        const topping = () => {
            window.scrollTo({
                top: 0,
                behavior: "smooth"
            });
        };

        window.addEventListener("scroll", scrolling);
        backtotop.addEventListener("click", topping);

        const url = "https://script.google.com/macros/s/AKfycbypT_Qzc0d_eZ5v1yH4e46RK2NARXOplqZdsNUOfBgPRtYywrXA1mYzCYDflVJVRO4zpA/exec"
        let param = "2568_10"
        let query = "?date="
        let count_true = 0
        axios.get(url + query + param)
            .then(response => {
                count.classList.remove("skeleton", "skeleton-text")
                load.style.display = "none"
                pending.style.display = "grid"
                sent.style.display = "grid"
                const data = response.data
                for (i = 0; i < data.length; i++) {
                    let tr = document.createElement("tr")
                    let td_name = document.createElement("td")
                    let div = document.createElement("div")
                    div.classList.add("grid", "grid-cols-1")
                    let p1 = document.createElement("p")
                    p1.innerText = data[i][1]
                    p1.classList.add("text-lg")
                    let p2 = document.createElement("p")
                    p2.innerText = data[i][0] + " | " + data[i][2]
                    p2.classList.add("text-sm", "text-gray-600")
                    div.appendChild(p1)
                    div.appendChild(p2)
                    tr.appendChild(td_name).appendChild(div)
                    let td_status = document.createElement("td")
                    let icon = document.createElement("i")
                    if (data[i][3]) {
                        count_true += 1
                        icon.classList.add("fa-solid", "fa-check")
                        td_status.appendChild(icon)
                        td_status.classList.add("text-base")
                        tbody_sent.appendChild(tr).appendChild(td_status)
                    } else {
                        icon.classList.add("fa-solid", "fa-xmark")
                        td_status.appendChild(icon)
                        td_status.classList.add("text-base")
                        tbody_pending.appendChild(tr).appendChild(td_status)
                    }
                }
                count.innerText = "(ส่ง " + count_true + " จาก " + data.length + " ราย)"
            }
            )

    </script>
</body>

</html>